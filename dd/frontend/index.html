<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="./web3.min.js"></script>
    <script type="text/javascript" src="./bower_components/jquery/dist/jquery.min.js"></script>
    <!-- <script  src="http://code.jquery.com/jquery-latest.min.js"></script> -->
    <script type="text/javascript" src="./inpage.js"></script>
    <script type="text/javascript">
        var Web3 = require('web3');
        console.log(window.ethereum)
       /* window.addEventListener('load', function () {
            if (typeof web3 !== 'undefined') {

                console.log('Web3 Detected! ' + web3.currentProvider.constructor.name)
                window.web3 = new Web3(web3.currentProvider);
                console.log(Web3.givenProvider);
            } else {
                console.log('No Web3 Detected... using HTTP Provider')
                web3 = new Web3(Web3.givenProvider || "ws://ropsten.infura.io/v3/9a9dcb1ea0784cafb2dc608fdca92642")
                //web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/v3/9a9dcb1ea0784cafb2dc608fdca92642"));
                console.log(Web3)
                console.log(Web3.givenProvider);
                
            }
        })
        */
        let account;
        window.addEventListener('load',async function() {
            console.log("ASD");
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
            }
            // Legacy dapp browsers...
            else if (window.web3) {
                console.log('Web3 Detected! ' + web3.currentProvider.constructor.name)
                window.web3 = new Web3(web3.currentProvider);
                console.log(Web3.givenProvider);
            }
            // Non-dapp browsers...
            else {
                console.log('No Web3 Detected... using HTTP Provider')
                web3 = new Web3(Web3.givenProvider || "ws://ropsten.infura.io/v3/9a9dcb1ea0784cafb2dc608fdca92642")
                //web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/v3/9a9dcb1ea0784cafb2dc608fdca92642"));
                console.log(Web3)
                console.log(Web3.givenProvider);            
            }
            if(web3)
            {
                account = await web3.eth.requestAccounts();
            }
          });

          console.log(ethereum)
          async function gg() {
              console.log(`gg start`);
            const accounts22 =  await window.ethereum.request({ method: 'eth_requestAccounts' })
            console.log(accounts22)
            console.log("gg end")
          }
          gg()
        let Voting = "";
        $(document).ready(function() {
            console.log(window)
            console.log(web3.version)
            console.log("ready")
            web3.setProvider(new web3.providers.HttpProvider("https://ropsten.infura.io/v3/9a9dcb1ea0784cafb2dc608fdca92642"))
            let VotingContract = web3.eth.contract([
        {
            "inputs": [],
            "stateMutability": "nonpayable",
            "type": "constructor"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "name": "candidateAddrs",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "string",
                    "name": "_name",
                    "type": "string"
                }
            ],
            "name": "candidateEnroll",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "name": "candidates",
            "outputs": [
                {
                    "internalType": "string",
                    "name": "name",
                    "type": "string"
                },
                {
                    "internalType": "uint256",
                    "name": "votedCount",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "string",
                    "name": "a",
                    "type": "string"
                },
                {
                    "internalType": "string",
                    "name": "b",
                    "type": "string"
                }
            ],
            "name": "stringCompare",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "pure",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "string",
                    "name": "_to",
                    "type": "string"
                }
            ],
            "name": "viewCandidatesVotingCount",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "string",
                    "name": "_name",
                    "type": "string"
                },
                {
                    "internalType": "string",
                    "name": "_to",
                    "type": "string"
                }
            ],
            "name": "vote",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "name": "voters",
            "outputs": [
                {
                    "internalType": "string",
                    "name": "name",
                    "type": "string"
                },
                {
                    "internalType": "uint256",
                    "name": "votingCount",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        }
    ])
            Voting = VotingContract.at('0xc691Dd6b3C5781350197cd16d84330bC97beC24a')
            web3.eth.defaultAccount = '0x5587acE223024b4B9806466eeD79F17518435350'
            console.log(Voting)
            console.log(web3.eth.defaultAccount)
            console.log(web3)

            let curAccount =  web3.eth.getAccounts()
            console.log(curAccount)

        })
        

        function getBalance() {
            var address, wei, balance
            address = document.getElementById("address").value
            try {
                web3.eth.getBalance(address, function (error, wei) 
                {
                    console.log(address);
                    console.log(web3.eth.accounts);
                    if (!error) {
                        var balance = web3.fromWei(wei, 'ether');
                        document.getElementById("output").innerHTML = balance + " ETH";
                    }
                });
            } catch (err) {
                document.getElementById("output").innerHTML = err;
            }
        }
    </script>
</head>
<body>
    <h1>ETH Balance Fetcher</h1>
    <p>Enter your Ethereum Address:</p>
    <input type="text" size="50" id="address" />
    <button type="button" onClick="getBalance();">Get Balance</button>
    <br />
    <br />
    <div id="output"></div>
</body>
</html>
